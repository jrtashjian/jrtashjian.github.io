<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <title>Image Thumbnail Creation &amp; Caching With CodeIgniter | JR Tashjian</title>
        <meta name="description" content="Senior Software Engineer">

        <meta property="og:title" content="Image Thumbnail Creation &amp; Caching With CodeIgniter | JR Tashjian"/>
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://jrtashjian.com/2009/02/image-thumbnail-creation-caching-with-codeigniter"/>
        <meta property="og:description" content="Senior Software Engineer" />
        <meta property="og:image" content="https://jrtashjian.com/assets/images/about-page.webp" />

        <!-- Twitter Meta Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta property="twitter:domain" content="jrtashjian.com">
        <meta property="twitter:url" content="https://jrtashjian.com">
        <meta name="twitter:title" content="Image Thumbnail Creation &amp; Caching With CodeIgniter | JR Tashjian">
        <meta name="twitter:description" content="Senior Software Engineer">
        <meta name="twitter:image" content="https://jrtashjian.com/assets/images/about-page.webp">


        <link rel="canonical" href="https://jrtashjian.com/2009/02/image-thumbnail-creation-caching-with-codeigniter">
        <link rel="icon" href="/assets/images/favicon-32x32.jpg" sizes="32x32" />
        <link rel="icon" href="/assets/images/favicon-192x192.jpg" sizes="192x192" />
        <link rel="apple-touch-icon" href="/assets/images/favicon-180x180.jpg" />
        <meta name="msapplication-TileImage" content="/assets/images/favicon-270x270.jpg" />

                <script defer data-domain="jrtashjian.com" src="https://plausible.jrtashjian.com/js/plausible.js"></script>
        
        <link rel="stylesheet" href="/assets/build/css/main.css?id=4e5d00fa5633ea52d10317e19903d42b">
        <script defer src="/assets/build/js/main.js?id=70f6d1d6eeef91fcbf04b0be8a530710"></script>

        <link rel="alternate" type="application/rss+xml" title="All Posts by JR Tashjian (The RSS Feed)" href="https://jrtashjian.com/feed.xml" />
    </head>
    <body class="bg-white dark:bg-black text-black dark:text-white font-mono leading-relaxed px-4">
        <div class="mx-auto max-w-prose">

            <header class="flex flex-wrap mb-8 py-8 border-b-8 border-black dark:border-white" role="banner">
                <a href="/" title="JR Tashjian home" class="my-2">
                    <h1 class="font-bold">~/jrtashjian</h1>
                </a>
                <div class="h-card flex ml-auto mr-0">
                    <a href="https://talos.link/@jrtashjian" rel="me" class="u-url inline-flex ml-3 my-2">
                        <svg class="mr-2 fill-current" width="24" height="24" view-box="0 0 24 24" version="1.1">
                            <path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z" />
                        </svg>
                        Mastodon
                    </a>
                    <a href="mailto:hello@jrtashjian.com" class="u-email inline-flex ml-3 my-2">
                        <svg class="mr-2 fill-current" width="24" height="24" view-box="0 0 24 24" version="1.1">
                            <path d="M20,4H4C2.895,4,2,4.895,2,6v12c0,1.105,0.895,2,2,2h16c1.105,0,2-0.895,2-2V6C22,4.895,21.105,4,20,4z M20,8.236l-8,4.882 L4,8.236V6h16V8.236z" />
                        </svg>
                        Email
                    </a>
                </div>
            </header>

            <main role="main">
                	<article class="h-entry">
		<header>
			<h1 class="p-name">Image Thumbnail Creation &amp; Caching With CodeIgniter</h1>
			<time class="dt-published mr-3" datetime="2009-02-24T19:00:00-05:00" title="Published on February 25, 2009">February 25, 2009</time>
			<a class="p-author h-card sr-only" href="http://jrtashjian.com">JR Tashjian</a>
		</header>

		
		<div class="e-content">
			<p>How you handle the saving and display of images is very important while planning your web app. Questions you would ask yourself include: How should images be stored? What will the standard naming conventions be? How will thumbnails be created? In this article, I will be focusing on how I decided the way thumbnails would be generated in my applications.</p>

<h2>Initial Plan</h2>

<p>When I first started planning how images would be handled in a recent app, things went quite smoothly. I planned the logic flow like this:</p>

<ol>
<li>User uploads image</li>
<li>PHP saves image in <code>/assets/images/</code> directory</li>
<li>PHP would loop through an array of pre-defined image dimensions and create image thumbnails from the image</li>
<li>To display thumbnail, pass the path to thumbnail in image <code>src</code> attribute.</li>
</ol>

<p>Not so hard right? WRONG!</p>

<h2>The Problem</h2>

<p>In one of my config files, I created an array which you could specify multiple image dimensions (height and width) for use throughout the website/application. This works BUT, what if the person coding the front-end needs different dimensions for an already uploaded image? Or, maybe the client requires a small sizing change to the thumbnail?</p>

<p>Looping through the array sounded like a good idea but, for small changes like these requires more work than needed. If I continued using the array method to update or add a new thumbnail dimension, every previously uploaded image would need to be updated with the new thumbnail. There has to be a better way.</p>

<h2>The Solution</h2>

<p>With the task at hand, a <a href="http://mondaybynoon.com">friend</a> of mine lead me to a PHP library called <a href="http://phpthumb.sourceforge.net/">phpThumb()</a>. phpThumb() uses the GD library to create thumbnails from images on the fly. This is exactly what I needed. A way to dynamically create image thumbnails rather than pre-defined dimensions. phpThumb() was the way to go but, I didn't want to just use the library, I wanted to understand it. What better way to understand a library than to create one yourself?</p>

<h2>The Function</h2>

<p>By nature, this function will be a helper function in <a href="http://codeigniter.com/">CodeIgniter</a>. The only library being used will be the <a href="http://codeigniter.com/user_guide/libraries/image_lib.html">Image Library</a>.</p>

<p>To begin creating the function, we need to create a file in our <code>./application/helpers/</code> directory. I will be calling this file <code>image_helper.php</code>. Now we can create our function.</p>

<p>To generate a thumbnail of an image on the fly, we will have to pass 3 parameters to our function: The image path, the specified height, and the specified width. I will be naming the function <code>image_thumb</code>. You can use any name you wish.</p>

<pre><code>&lt;?php

function image_thumb( $image_path, $height, $width ) {
    // code
}

/* End of file image_helper.php */
/* Location: ./application/helpers/image_helper.php */
</code></pre>

<p>In order to use the Image Library of CodeIgniter, we need the CodeIgniter object available to us. In the current state of the function, if we used <code>$this-&gt;load-&gt;library('image_lib')</code> to load the Image Library, the function would throw error. This is because helpers in CodeIgniter are not classes but rather a collection of functions. So, how do we use CodeIgniter's libraries in our helper? CodeIgniter's got us covered! CodeIgniter has a function called <code>get_instance()</code> which returns the CodeIgniter super object. We will use it like so:</p>

<pre><code>function image_thumb( $image_path, $height, $width ) {
    // Get the CodeIgniter super object
    $CI =&amp; get_instance();
}
</code></pre>

<p>It is important to be aware that we are passing the <code>get_instance()</code> function by reference. Passing by reference allows us to use the original CodeIgniter object (already in memory) rather than creating a copy of it (duplicating memory). Passing variables and functions by reference comes in handy when optimizing your PHP application. But, that is another article for another day.</p>

<p>The next thing we must do is figure out where to store the generated thumbnails. This is for caching purposes. When the function is used, the original image path is passed to it. To get the directory path from the image path we will use PHP's built-in <code>dirname()</code> function.</p>

<p>For example: I would pass <code>assets/images/picture-1/picture-1.jpg</code> as the original image file path and <code>dirname('assets/images/picture-1/picture-1.jpg')</code> would return <code>assets/images/picture-1/</code> as the directory to save the generated thumbnails. Notice I will not pass the path with a beginning slash (/).</p>

<p>We also need to construct the filename we want for our thumbnail image. I will make the filename <code>height_width.jpg</code> because all of my images are grouped inside their own folders. Take a look at the updated function:</p>

<pre><code>function image_thumb( $image_path, $height, $width ) {
    // Get the CodeIgniter super object
    $CI =&amp; get_instance();

    // Path to image thumbnail
    $image_thumb = dirname( $image_path ) . '/' . $height . '_' . $width . '.jpg';
}
</code></pre>

<p>Now, the way caching works in this function is if the image thumbnail path (<code>$image_thumb</code>) exists, the thumbnail has already been created therefore does not need to be generated again. If the file does not exists, we need to create it!</p>

<p>To create the image thumbnail, we need to load CodeIgniter's Image Library.</p>

<pre><code>function image_thumb( $image_path, $height, $width ) {
    // Get the CodeIgniter super object
    $CI =&amp; get_instance();

    // Path to image thumbnail
    $image_thumb = dirname( $image_path ) . '/' . $height . '_' . $width . '.jpg';

    if ( !file_exists( $image_thumb ) ) {
        // LOAD LIBRARY
        $CI-&gt;load-&gt;library( 'image_lib' );
    }
}
</code></pre>

<p>Before we can do anything with the Image Library, we need to configure it.</p>

<pre><code>function image_thumb( $image_path, $height, $width ) {
    // Get the CodeIgniter super object
    $CI =&amp; get_instance();

    // Path to image thumbnail
    $image_thumb = dirname( $image_path ) . '/' . $height . '_' . $width . '.jpg';

    if ( !file_exists( $image_thumb ) )
    {
        // LOAD LIBRARY
        $CI-&gt;load-&gt;library( 'image_lib' );

        // CONFIGURE IMAGE LIBRARY
        $config['image_library']    = 'gd2';
        $config['source_image']     = $image_path;
        $config['new_image']        = $image_thumb;
        $config['maintain_ratio']   = TRUE;
        $config['height']           = $height;
        $config['width']            = $width;
        $CI-&gt;image_lib-&gt;initialize( $config );
    }
}
</code></pre>

<p>I am using GD2 as the image library. You can use what you wish, gd2 is default. The source_image config variable is the path to the original (full-size) image. The new_image config variable is the path to our specified thumbnail image. CodeIgniter will save the thumbnail to this path. I have set maintain_ratio to TRUE so that CodeIgniter automatically resizes our image to the best dimensions to fit our specified height and width, without distorting the image in any way.</p>

<p>Finally, we initialize our configuration:</p>

<pre><code>$CI-&gt;image_lib-&gt;initialize( $config );
</code></pre>

<p>After configuration is complete, we need to process the image to generate our thumbnail. Do this by running <code>$CI-&gt;image_lib-&gt;resize()</code>. After resizing the image, we need to reset all values used by the Image Library when processing an image. Do this by running <code>$CI-&gt;image_lib-&gt;clear()</code>.</p>

<p>Last but not least, we need to return our thumbnail! In my function, I have returned the HTML image tag (<code>img</code>) with the thumbnail path already in the source (<code>src</code>) attribute. You can just return the path if you want, just return the generated src path.</p>

<h2>The Complete Function</h2>

<pre><code>&lt;?php

function image_thumb( $image_path, $height, $width ) {
    // Get the CodeIgniter super object
    $CI =&amp; get_instance();

    // Path to image thumbnail
    $image_thumb = dirname( $image_path ) . '/' . $height . '_' . $width . '.jpg';

    if ( !file_exists( $image_thumb ) ) {
        // LOAD LIBRARY
        $CI-&gt;load-&gt;library( 'image_lib' );

        // CONFIGURE IMAGE LIBRARY
        $config['image_library']    = 'gd2';
        $config['source_image']     = $image_path;
        $config['new_image']        = $image_thumb;
        $config['maintain_ratio']   = TRUE;
        $config['height']           = $height;
        $config['width']            = $width;
        $CI-&gt;image_lib-&gt;initialize( $config );
        $CI-&gt;image_lib-&gt;resize();
        $CI-&gt;image_lib-&gt;clear();
    }

    return '&lt;img src="' . dirname( $_SERVER['SCRIPT_NAME'] ) . '/' . $image_thumb . '" /&gt;';
}

/* End of file image_helper.php */
/* Location: ./application/helpers/image_helper.php */
</code></pre>

<h2>Using the Function</h2>

<p>In order to use the function, you will need to load the helper, either in your controller or the application autoload file.</p>

<p>General usage in View:</p>

<pre><code>&lt;?php echo image_thumb( 'assets/images/picture-1/picture-1.jpg', 50, 50 ); ?&gt;
</code></pre>
		</div>
	</article>
            </main>

            <footer class="flex justify-end mt-8 py-8 border-t-8 border-black dark:border-white" role="contentinfo">
                Copyright (c) 2022 JR Tashjian
            </footer>
        </div>
    </body>
</html>
