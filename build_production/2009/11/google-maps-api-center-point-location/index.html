<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <title>Google Maps API: Center Point Location | JR Tashjian</title>
        <meta name="description" content="Senior Software Engineer">

        <meta property="og:title" content="Google Maps API: Center Point Location | JR Tashjian"/>
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://jrtashjian.com/2009/11/google-maps-api-center-point-location"/>
        <meta property="og:description" content="Senior Software Engineer" />
        <meta property="og:image" content="https://jrtashjian.com/assets/images/about-page.webp" />

        <!-- Twitter Meta Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta property="twitter:domain" content="jrtashjian.com">
        <meta property="twitter:url" content="https://jrtashjian.com">
        <meta name="twitter:title" content="Google Maps API: Center Point Location | JR Tashjian">
        <meta name="twitter:description" content="Senior Software Engineer">
        <meta name="twitter:image" content="https://jrtashjian.com/assets/images/about-page.webp">


        <link rel="canonical" href="https://jrtashjian.com/2009/11/google-maps-api-center-point-location">
        <link rel="icon" href="/assets/images/favicon-32x32.jpg" sizes="32x32" />
        <link rel="icon" href="/assets/images/favicon-192x192.jpg" sizes="192x192" />
        <link rel="apple-touch-icon" href="/assets/images/favicon-180x180.jpg" />
        <meta name="msapplication-TileImage" content="/assets/images/favicon-270x270.jpg" />

                <script defer data-domain="jrtashjian.com" src="https://plausible.jrtashjian.com/js/plausible.js"></script>
        
        <link rel="stylesheet" href="/assets/build/css/main.css?id=4e5d00fa5633ea52d10317e19903d42b">
        <script defer src="/assets/build/js/main.js?id=70f6d1d6eeef91fcbf04b0be8a530710"></script>

        <link rel="alternate" type="application/rss+xml" title="All Posts by JR Tashjian (The RSS Feed)" href="https://jrtashjian.com/feed.xml" />
    </head>
    <body class="bg-white dark:bg-black text-black dark:text-white font-mono leading-relaxed px-4">
        <div class="mx-auto max-w-prose">

            <header class="flex flex-wrap mb-8 py-8 border-b-8 border-black dark:border-white" role="banner">
                <a href="/" title="JR Tashjian home" class="my-2">
                    <h1 class="font-bold">~/jrtashjian</h1>
                </a>
                <div class="h-card flex ml-auto mr-0">
                    <a href="https://talos.link/@jrtashjian" rel="me" class="u-url inline-flex ml-3 my-2">
                        <svg class="mr-2 fill-current" width="24" height="24" view-box="0 0 24 24" version="1.1">
                            <path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041 0h-.076c-3.068.025-6.02.357-7.74 1.147 0 0-3.411 1.526-3.411 6.732 0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499 0 0 1-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085 0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z" />
                        </svg>
                        Mastodon
                    </a>
                    <a href="mailto:hello@jrtashjian.com" class="u-email inline-flex ml-3 my-2">
                        <svg class="mr-2 fill-current" width="24" height="24" view-box="0 0 24 24" version="1.1">
                            <path d="M20,4H4C2.895,4,2,4.895,2,6v12c0,1.105,0.895,2,2,2h16c1.105,0,2-0.895,2-2V6C22,4.895,21.105,4,20,4z M20,8.236l-8,4.882 L4,8.236V6h16V8.236z" />
                        </svg>
                        Email
                    </a>
                </div>
            </header>

            <main role="main">
                	<article class="h-entry">
		<header>
			<h1 class="p-name">Google Maps API: Center Point Location</h1>
			<time class="dt-published mr-3" datetime="2009-11-22T19:00:00-05:00" title="Published on November 23, 2009">November 23, 2009</time>
			<a class="p-author h-card sr-only" href="http://jrtashjian.com">JR Tashjian</a>
		</header>

		
		<div class="e-content">
			<p>As stated in the <a href="https://jrtashjian.com/2009/11/google-maps-api-custom-zoom-slider/" title="Google Maps API: Custom Zoom Slider">last article</a>, I have been working a lot with the <a href="http://code.google.com/apis/maps/">Google Maps API</a> for a current client project. The most recent problem, was the application was required to display a quick overview of the current location the user was looking at. The City and the State.</p>

<p>Again, <a href="http://jquery.com/">jQuery</a> will be used in this demo and we will be using the <a href="http://code.google.com/apis/maps/documentation/javascript/v2/reference.html#GClientGeocoder">GClientGeocoder</a> service.</p>

<h2>Loading Google Maps API</h2>

<p>Here is the HTML for the map and the initial Google Maps API javascript code:</p>

<pre><code>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us"&gt;
&lt;head profile="http://gmpg.org/xfn/11"&gt;

    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;
    &lt;title&gt;Google Maps API: Center Point Location&lt;/title&gt;

    &lt;!-- JQUERY --&gt;
    &lt;script type="text/javascript" charset="utf-8" src="javascript/jquery.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" charset="utf-8" src="javascript/jquery.ui.js"&gt;&lt;/script&gt;

    &lt;!-- GOOGLE MAPS API --&gt;
    &lt;script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=YOUR_API_KEY_HERE" type="text/javascript"&gt;&lt;/script&gt;

    &lt;script type="text/javascript"&gt;
    // store the current zoom level for reference with google maps and custom zoom slider
    var currentZoomLevel = 10;

    // map object (global)
    var map;

    // geocoder object (global)
    var geocoder = new GClientGeocoder();

    $(document).ready(function() {
        // create the google map
        map = new GMap2(document.getElementById("map"));

        // set starting center point
        map.setCenter(new GLatLng(37.4419, -122.1419), currentZoomLevel);

        // set map UI as default
        map.setUIToDefault();
    });
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div id="container"&gt;
    &lt;h1&gt;Google Maps API: Center Point Location&lt;/h1&gt;

    &lt;div id="content"&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;State: &lt;/strong&gt;&lt;span id="map-state"&gt;current state&lt;/span&gt;&lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;City: &lt;/strong&gt;&lt;span id="map-city"&gt;current city&lt;/span&gt;&lt;/li&gt;
        &lt;/ul&gt;

        &lt;div id="map"&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h2>Retrieving the Current Location</h2>

<p>Now that Google Maps API has been loaded, we need to create a function to get the current center-point's Longitude and Latitude. Then we need to get the address, via GClientGeocoder. Then we need to strip out the data we need and update our display.</p>

<pre><code>function updateMapLocation() {
    geocoder.getLocations(map.getCenter().toString(), function(point) {

        var currentAddress = point.Placemark[0].address;
        currentAddress = $.trim(currentAddress);
        var currentAddressMatches = currentAddress.split(/^([^,]\*),s([^,]\*),s([A-Z]{2})s([0-9]\*),s([^,]\*)$/);

        if(/^([^,]\*),s([a-zA-Z^,]\*)[0-9s]\*,s[^,]\*$/.test(currentAddress)) {
            var currentAddressMatches = currentAddress.split(/^([^,]\*),s([a-zA-Z^,]\*)[0-9s]\*,s[^,]\*$/);
        } else if(/^[^,]\*,s([^,]\*),s([a-zA-Z^,]\*)[0-9s]\*,s[^,]\*$/.test(currentAddress)) {
            var currentAddressMatches = currentAddress.split(/^[^,]\*,s([^,]\*),s([a-zA-Z^,]\*)[0-9s]\*,s[^,]\*$/);
        }

        var currentCity = currentAddressMatches[1];
        var currentState = currentAddressMatches[2];

        $('span#map-state').html(currentState);
        $('span#map-city').html(currentCity);
    });
}
</code></pre>

<p>In the code above, I realized GClientGeocoder was returning addresses for the current center point, in a few different formats. The two regular expression tests determine which format was returned and then splits out the data we need. After the data has been retrieved, we update the HTML display for <code>span#map-state</code> and <code>span#map-city</code>.</p>

<p>Now that we have a function to pull the address portions, we need to call it somewhere! I have two places where I have decided was the best time to update the location. When the maps is loaded (on page load) and anytime the map has been moved or zoomed.</p>

<p>So, we write an if statement to check if <a href="http://code.google.com/apis/maps/documentation/javascript/v2/reference.html#GMap2.isLoaded"><code>maps.isLoaded()</code></a> and then we need to <a href="http://code.google.com/apis/maps/documentation/javascript/v2/reference.html#GEvent.addListener"><code>addListenter()</code></a> to event <code>moveend</code>.</p>

<pre><code>// once map has fully loaded, update current location in view
if(map.isLoaded()) { updateMapLocation(); }

// update location in view upon changing the map in any way
GEvent.addListener(map, 'moveend', function() { updateMapLocation(); });
</code></pre>
		</div>
	</article>
            </main>

            <footer class="flex justify-end mt-8 py-8 border-t-8 border-black dark:border-white" role="contentinfo">
                Copyright (c) 2022 JR Tashjian
            </footer>
        </div>
    </body>
</html>
